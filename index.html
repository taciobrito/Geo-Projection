<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8">
  <title>Teste D3</title>

   <style type="text/css">

  
   </style>

</head>
<body>
  	<script src="https://d3js.org/d3.v4.min.js"></script>
  	<script src="https://d3js.org/d3-queue.v2.min.js"></script>
  	<script src="https://d3js.org/topojson.v2.min.js"></script>
    <script>
        // Defini altura e largura
        var width = 960, height = 500;

        var svg = d3.select("body").append("svg")
           .attr("width", width).attr("height", height);
        
        var color = d3.scaleLinear()
          .domain([2, 30])
          .range(["#00ff00", "#0000ff"]);

        var transform = d3.zoomIdentity;
        

        var projection = d3.geoMercator();

        var sf = projection([-122.417, 37.775]);
        var center = projection.translate();

        var scale, translate, area; // minimum area threshold

        var clip = d3.geoClipExtent()
            .extent([[0, 0], [width, height]]);

        var simplify = d3.geoTransform({
          point: function(x, y, z) {
            if (z >= area) this.stream.point(x * scale + translate[0], y * scale + translate[1]);
          }
        });

        /*var projection = d3.geoMercator().scale([300])
               .center([0,1])
               .rotate([50,0,0])
               .translate([width/2, height/2])
               .clipAngle(90);*/

        var g = svg.append("g");

        var path = d3.geoPath().projection(projection);
        
        svg.call(d3.zoom()
            .scaleExtent([1 / 2, 8])
            .on("zoom", zoomed));

        /*var zoom = d3.zoom()
           .scaleExtent([1, 40])
           .translateExtent([[-100, -100], [width + 90, height + 100]])
           .on("zoom", zoomed);
        g.call(zoom);*/

        /*var mapa = d3.map();

        var quantize = d3.scaleQuantize()
          .domain([0, 500])
          .range(d3.range(9).map(function(i) { return "q" + i + "-9"; }));*/

        d3.queue()
              .defer(d3.json, "d3/brasil.json")
              .await(carregarmapa);
              //.defer(d3.tsv, "data/enemcota.tsv", function(d) {
                 // mapa.set(d.uf, +d.quantidade);
                  //console.log(d.uf);
              //})

       function zoomed(){
           g.attr("transform", d3.event.transform);
       }

       function dragged(d) {
          d3.select(this).attr("cx", d.x = d3.event.x).attr("cy", d.y = d3.event.y);
        }

       function carregarmapa(error, shp) {
           if (error) return console.error(error);
            
            // Projeta o mapa
            var estados = topojson.feature(shp, shp.objects.brasil);

           /*g.selectAll(".estados")
                .data(estados.features).enter().append("path")
                .attr("class", function(d){ 
                  console.log(d.properties.sigla);
                    return "estados " + d.properties.sigla; })
                .attr("d", path);*/

            g.append("path")
               .datum(estados)
               .attr("d", path);

            g.selectAll(".estados")
              .data(estados.features)
              .enter().append("path")
              .style("fill", function(d){ return color(d.properties.NM_MUNICIP.replace(/\s+/g, '').length); })
                  
              .attr("cx", function(d) { return d.x; })
              .attr("cy", function(d) { return d.y; })
              .attr("r", 2.5)
              .call(d3.drag()
                  .on("drag", dragged))
              .attr("d", path);


           /* g.selectAll(".estados")
               .attr("class", "estados")
              .data(estados.features).enter().append("path")
              .style("fill", function(d){return color(d.properties.NM_MUNICIP.replace(/\s+/g, '').length); })
              .attr("d", path);*/

        }

   </script>

</body>

</html>