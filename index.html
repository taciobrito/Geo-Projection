<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8">
  <title>Teste D3</title>

   <style type="text/css">

     .contorno{
         fill: #fff;
         stroke: #333;
         stroke-linejoin: round;
     }
   </style>

</head>
<body>
  	<script src="https://d3js.org/d3.v4.min.js"></script>
  	<script src="https://d3js.org/d3-queue.v2.min.js"></script>
  	<script src="https://d3js.org/topojson.v2.min.js"></script>
    <script>
        // Defini altura e largura
        var width = 800, height = 400; 
       	var svg = d3.select("body").append("svg")
           .attr("width", width).attr("height", height);
        var g = svg.append("g");

        var projection = d3.geoMercator().scale(300)
               .rotate([50,0,0])
               .translate([width/2, height/2])
               .clipAngle(90);
        var path = d3.geoPath().projection(projection);

        var zoom = d3.zoom()
           .scaleExtent([1, 40])
           .translateExtent([[-100, -100], [width + 90, height + 100]])
           .on("zoom", zoomed);
        g.call(zoom);

        var mapa = d3.map();

        var quantize = d3.scaleQuantize()
          .domain([0, 500])
          .range(d3.range(9).map(function(i) { return "q" + i + "-9"; }));

        d3.queue()
              .defer(d3.json, "d3/brasil.json")
              .defer(d3.tsv, "data/enemcota.tsv", function(d) {
                  mapa.set(d.uf, +d.quantidade);
                  //console.log(d.uf);
              })
              .await(carregarmapa);

       function zoomed(){
           g.attr("transform", d3.event.transform);
       }

       function carregarmapa(error, shp) {
            // Projeta o mapa
           if (error) return console.error(error);
            var subunits = topojson.feature(shp, shp.objects.brasil);

           /* g.selectAll(".estados")
                .data(subunits.features).enter().append("path")
                .attr("class", function(d){ 
                  //console.log(d);
                    return "estados " + d.properties.sigla; })
                .attr("d", path);*/

            g.append("path")
               .datum(subunits).attr("d", path)
               .attr("class", "contorno");

            g.selectAll(".estados")
              .data(subunits.features).enter().append("path")
              .attr("d", path)
              .attr("class", function(d) { 
                //console.log(d.properties.sigla);
                return quantize(mapa.get(d.properties.sigla));
              
            });

        }

   </script>

</body>

</html>